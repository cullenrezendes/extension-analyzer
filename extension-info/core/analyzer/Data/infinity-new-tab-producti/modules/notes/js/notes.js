"use strict";infinity.modules["notes-notes"]=function(){return new Vue({el:"#v-notes",data:{notes:{}},created:function(){var t=this;$(document).on("click",".notes-content a",function(t){t.preventDefault();var e=$(this).attr("href");window.open(e,"_blank")}),t.handleMessage(),t.updateData(function(){t.onOpen()})},methods:{close:function(){iView.hideSideBar()},onOpen:function(){$(".i-notes").on("transitionend",function(t){0<=t.target.className.indexOf("i-notes")&&0<=t.target.className.indexOf("i-side-show")&&setTimeout(function(){$("#notes-content")[0].focus()},50)})},handleMessage:function(){var t=this;infinity.onMessage("notesDataUpdate",function(){t.updateData()}),infinity.onMessage("onRecoverySetView",function(){t.updateData()})},updateData:function(e){var n=this;infinity.get("infinity-data",!0,function(t){t.notes.map(function(t){t.__select__=!1}),n.notes=t.notes,n.setSelect(n.notes[0],!0),n.fillText(n.notes[0]),e&&e()})},saveAndSync:function(){var e=this;infinity.get("infinity-data",!0,function(t){t.notes=e.notes,infinity.set("infinity-data",t,!0,function(){infinity.sendMessage("notesDataUpdate"),infinity.sendMessage("backupToCloud")})})},setSelect:function(t,e){this.notes.map(function(t){t.__select__=!1}),t.__select__=!0},changeNote:function(t){var e=this;e.setSelect(t,!0),e.fillText(t),e.setCaretPosition(e.$refs.noteInput,e.$refs.noteInput.innerHTML.length)},deleteIt:function(t,e){var n=this;t.stopPropagation();var i=n.notes.indexOf(e);n.notes.splice(i,1),n.saveAndSync()},newNote:function(){var t=this,e={text:"",__select__:!0,time:(new Date).getTime()};t.notes.unshift(e),t.setSelect(e,!0),t.fillText(e),t.$refs.noteInput.focus(),t.saveAndSync()},write:function(t){t.preventDefault();var e=this,n=$(".notes-content").html(),i=e.notes.filter(function(t,e){return t.__select__});i[0].time=(new Date).getTime(),i[0].text=e.autoLink(n),e.saveAndSync()},fillText:function(t){$(".notes-content").html(t.text)},transHtml:function(t,e){for(var n=(t=t.replace(/<\/p>/gi,"</p>\n")).match(/<img.*?(?:>|\/>)/gi),i=0;i<n.length;i++){var a=$(n[i]).attr("src");t=t.replace(n[i],'<p>\n{{{"infinity-src":"'+a+'"}}}\n</p>')}var o=$("<div>"+t+"</div>").text(),s=o.match(/{{{"infinity-src":".*"}}}/gi);for(i=0;i<s.length;i++){var c='<img src="'+JSON.parse(s[i].replace("{{","").replace("}}",""))["infinity-src"]+'">';o=o.replace(s[i],c)}return o=this.autoLink(o.replace(/\n/gi,"<br>")),$.trim(o)},autoLink:function(c){var r=[].slice;return function(){var i,e,a,n,t,o,s;return o=/(^|[\s\n]|<[A-Za-z]*\/?>)((?:https?|ftp):\/\/[\-A-Z0-9+\u0026\u2019@#\/%?=()~_|!:,.;]*[\-A-Z0-9+\u0026@#\/%=~()_|])/gi,0<(t=1<=arguments.length?r.call(arguments,0):[]).length?(n=t[0],i=n.callback,a=function(){var t;for(e in t=[],n)s=n[e],"callback"!==e&&t.push(" "+e+"='"+s+"'");return t}().join(""),c.replace(o,function(t,e,n){return""+e+(("function"==typeof i?i(n):void 0)||"<a href='"+n+"'"+a+">"+n+"</a>")})):c.replace(o,"$1<a href='$2'>$2</a>")}()},trim:function(t){var e=document.createElement("div");e.innerHTML=t;var n=e.innerText;return $.trim(n)},paste:function(e){var n=this;e.preventDefault();var i="";try{var t=e.clipboardData.getData("text/html");i=n.transHtml(t,e)}catch(t){try{i=e.clipboardData.getData("text/plain");var a=/\n/gi;i=i.replace(a,"<br>"),i=$.trim(i),i=n.autoLink(i)}catch(t){i=""}}document.execCommand("insertHtml",!1,i)},setCaretPosition:function(t,e){try{var n=(o=document.getElementById("notes-content")).childNodes.length,i=document.createRange(),a=window.getSelection();i.setStart(o.childNodes[n-1],o.innerHTML.length),i.collapse(!0),a.removeAllRanges(),a.addRange(i),o.focus()}catch(t){var o;(o=document.getElementById("notes-content")).focus()}}}})};