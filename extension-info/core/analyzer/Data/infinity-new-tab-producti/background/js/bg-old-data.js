"use strict";var typeMap={weather:{uid:"eed2a9287b324510678cd5e714888e99",name:infinity.i18n("weather"),url:"infinity://weather",src:"https://infinityicon.infinitynewtab.com/user-share-icon/b6a95410ed77627337567fea2cbb157c.png",iconType:"official"},todos:{uid:"c09f31db43d7faca5bf659fadad3967c",name:infinity.i18n("todos"),url:"infinity://todos",src:"https://infinityicon.infinitynewtab.com/user-share-icon/6e49210c084629259f22609980c48ecf.png",iconType:"official"},notepad:{uid:"ea5ac5d9e9e08c1d57ad413e9e38d376",name:infinity.i18n("notes"),url:"infinity://notes",src:"https://infinityicon.infinitynewtab.com/user-share-icon/006b88c07a2e87d5a61f3c969a70575c.png",iconType:"official"},bookmarks:{uid:"96646a13688f5bfd0aaf4811a579aee1",name:infinity.i18n("bookmarks"),url:"infinity://bookmarks",src:"https://infinityicon.infinitynewtab.com/user-share-icon/31a36139ccf4b9b005ec55445bf833b0.png",iconType:"official"},history:{uid:"4528cef4f8d66e661cb3143af733694e",name:infinity.i18n("history"),url:"infinity://history",src:"https://infinityicon.infinitynewtab.com/user-share-icon/faa06f85d37cdd552e2e57cb282ad0f7.png",iconType:"official"},gmail:{uid:"c5cb65ab55611b1d8bb2e09ad143b797",name:"Gmail",url:"infinity://gmail",src:"https://infinityicon.infinitynewtab.com/user-share-icon/7b6cee8dfbfeff522a7668c924429ad7.png",iconType:"official"},setting:{uid:"552fa3a378b29375843fa3d021cbe129",name:infinity.i18n("settings"),url:"infinity://settings",src:"https://infinityicon.infinitynewtab.com/user-share-icon/9622b98e90dd4f107d23481566095b34.png",iconType:"official"},apps:{uid:"194dd7b46ac16ac93becf5386f14bcca",name:infinity.i18n("extension"),url:"infinity://extension",src:"https://infinityicon.infinitynewtab.com/icon/194dd7b46ac16ac93becf5386f14bcca.png",iconType:"official"}},oldData={init:function(i){var t=this;localStorage.hasOwnProperty("main")&&localStorage.hasOwnProperty("setting")?t.backupOldData(function(){i&&i()}):i&&i(),infinity.alarms.onAlarm("checkBase64Icon",function(i){t.transferAllIcon2Cloud()}),infinity.alarms.get("checkBase64Icon",function(i){i||infinity.alarms.create("checkBase64Icon",{periodInMinutes:1440})}),t.handleMessage(),t.update2pro()},update2pro:function(){chrome.runtime.onMessageExternal.addListener(function(i,t,e){if("nnnkddnnlpamobajfibfdgfnbcnkgngh"==t.id){var a=infinity.get("infinity-icons"),o=infinity.get("infinity-searches"),s=infinity.get("infinity-settings");return infinity.get("infinity-data",!0,function(i){var t={type:"theNew__INFINITY",backupType:"cloud",version:10,icons:a,searches:o,settings:s,otherData:i},n=bgAutoBackup.createOldVersionBackupData(infinity.deepCopy(a),infinity.deepCopy(s),infinity.deepCopy(i),infinity.deepCopy(o));t.icon=decodeURIComponent(n.main),t.setting=decodeURIComponent(n.setting),e(t)}),!0}})},handleMessage:function(){var e=this;infinity.onMessage("transferOldData",function(i,t,n){return e.handleOldData(i.oldData,function(){var i={isSuccess:!0};e.transferAllIcon2Cloud(function(){n(i)})}),!0})},backupOldData:function(t){var n=this,i={user:infinity.get("user"),main:infinity.get("main"),setting:infinity.get("setting"),lastTime:infinity.get("lastTime")};infinity.set("infinity-old-data",i,!0,function(i){localStorage.clear(),n.handleOldData(i,t,!0)})},handleOldData:function(i,t,n,e){if(i.user)try{if(i.user.email&&i.user.password){bgUser.user.isLogin=!0,bgUser.user.email=i.user.email,bgUser.user.password=i.user.password;var a=parseInt(i.lastTime);bgUser.localData.backupTime=a,n&&(bgUser.user.backupTime=a);try{bgUser.user.name=bgUser.user.email.split("@")[0]}catch(i){bgUser.user.name="Infinity Undefined"}infinity.set("infinity-user",bgUser.user),infinity.set("infinity-local-data",bgUser.localData)}}catch(i){}if(i.main)try{for(var o=0;o<i.main.length;o++)for(var s=i.main[o],r=0;r<s.length;r++){var c=s[r],g={};if(c.bgColor&&"rgba(0,0,0,0)"==c.bgColor.replace(/\s/g,"")&&(c.bgColor="transparent"),typeMap.hasOwnProperty(c.type))g=typeMap[c.type];else if("ico"!=c.type||c.hasOwnProperty("title"))if("custom"==c.type||c.hasOwnProperty("title"))g.bgColor=c.bgColor?c.bgColor:"transparent",g.iconType="custom",g.name=c.name,g.showText=c.title.substr(0,2),g.url=c.url,c.ico?(g.customType="image",g.src=c.ico):(g.customType="text",g.src=""),g.uid=infinity.randomId("basic-old");else{if("app"!=c.type)continue;g.bgColor=c.bgColor,g.iconType="app",g.src=c.ico,g.name=c.name,g.url=c.url}else{g.iconType="official",g.name=c.name,g.url=c.url;var f=c.ico.indexOf("ouddn.com");if(0<f){var p=c.ico.substr(f+9,c.ico.length);g.src="https://infinityicon.infinitynewtab.com"+p}else g.src=c.ico;if(0==g.src.indexOf("https")){var d=void 0;try{d=new URL(g.src),g.src=d.origin+d.pathname}catch(i){}}g.bgColor=c.bgColor?c.bgColor:"transparent",g.uid=infinity.randomId("basic-old")}s[r]=g}infinity.set("infinity-icons",i.main)}catch(i){}if(i.setting)try{if(i.setting.iconNum){var l=i.setting.iconNum.split("x")[0],y=i.setting.iconNum.split("x")[1];bgSetting.options.column=parseInt(l)||2,bgSetting.options.row=parseInt(y)||5}try{bgSetting.options.isAutoBackUp=infinity.setting("isAutoBackUp")}catch(i){bgSetting.options.isAutoBackUp=!1}bgSetting.bingMd5=(new Date).getTime(),bgSetting.options.isOpenLinkInNewTab=i.setting.openInNewtab,bgSetting.options.isSearchInNewTab=i.setting.searchInNewtab,bgSetting.options.isOpenBookmarkInNewTab=i.setting.OpenBookmarksInNewtab,bgSetting.options.isOpentGmailNotication=i.setting.GmailMessage,bgSetting.options.isOpentGmailRingNotication=i.setting.notificationSound,bgSetting.options.isShowSearchBox=i.setting.searchBox,bgSetting.options.isShowSearchType=i.setting.searchType,bgSetting.options.iconBorderRadius=i.setting.iconFillet,bgSetting.options.iconOpacity=i.setting.iconOpacity,bgSetting.options.tempUnitC="Celsius"==i.setting.temperatureUnit,bgSetting.options.fontColor=i.setting.fontColor,bgSetting.options.isMinimalistMode=i.setting.minimalistMode,bgSetting.options.isShowTopBar=i.setting.displayAtTop,bgSetting.options.topBarType="Bookmarksbar"==i.setting.displayTopType?"bookmarks":"topsites",bgSetting.options.isOpenStartAnimation=i.setting.startAnimation;try{bgSetting.options.wallpaperType="local","infinity"==i.setting.bgType?bgSetting.options.wallpaperType="auto":"bing"==i.setting.bgType?bgSetting.options.wallpaperType="bing":"random"==i.setting.bgType&&(bgSetting.options.wallpaperType="random",bgSetting.options["random-wallpaper"]=i.setting.lastWallpaper),bgSetting.options.isBlurWallpaper=i.setting.blurWallpaper}catch(i){}if(infinity.set("infinity-settings",bgSetting.options),i.setting.wcity)try{bgWeather.setTheCityWeather(i.setting.wcity)}catch(i){}try{var b=i.setting.searchBottom.map(function(i,t){var n={type:"addse"};return n.name=i.name,n.url=i.searchStart+"%s"+i.searchEnd,n}),u=bgSearch.oldSearchNameToNewCurrentSearch(i.setting.searchEngine),m=infinity.get("infinity-searches");m?(u&&(m.current=u),m.additions=b,infinity.set("infinity-searches",m)):(u&&(bgSearch.searches.current=u),bgSearch.searches.additions=b)}catch(i){}i.setting.todostrue&&i.setting.todostrue.length&&(bgData.data.todos.todos=i.setting.todostrue.map(function(i,t){return{text:i,todoId:infinity.randomId("todo-id")}})),i.setting.todosfalse&&i.setting.todosfalse.length&&(bgData.data.todos.dones=i.setting.todosfalse.map(function(i,t){return{text:i,todoId:infinity.randomId("todo-id")}})),i.setting.notes&&i.setting.notes.length&&(bgData.data.notes=i.setting.notes.map(function(i,t){return{text:i.text,time:(new Date).getTime()}})),infinity.set("infinity-data",bgData.data,!0,function(){infinity.setting("toDoNumber",bgData.data.todos.todos.length),t&&t()})}catch(i){t&&t()}else t&&t()},transferAllIcon2Cloud:function(o){var s=infinity.get("infinity-icons"),a=[];s.map(function(i,e){i.map(function(i,t){if(i.src&&"data:image/"==i.src.substr(0,11)){var n={page:e,index:t};a.push(n)}})});var r=a.length;if(0!=r){var c=0;a.map(function(i,t){var n=void 0,e=void 0,a=void 0;try{n=i.page,e=i.index,a=s[n][e].src}catch(i){}a?infinity.uploadBase64Img({src:a,pre:900,scope:"custom-icon/",info:"basic-custom/",timeout:1e4,tokenTimeout:3e3},function(i,t){c+=1,i||(s[n][e].src=t,infinity.set("infinity-icons",s)),r<=c&&o&&o()}):r<=(c+=1)&&o&&o()})}else o&&o()}};