"use strict";var infinityDrag={dragSlideLock:!1,dragShadow:document.createElement("div"),dragShadowHide:document.createElement("div"),isDraging:!1,init:function(){var e=this;e.ondrag(),e.dragShadow.className="home-drag-shadow",$(e.dragShadow).html('<div class="home-drag-img BORDERRADIUS" id="home-drag-img"></div>'),e.dragShadowHide.className="home-drag-shadow home-drag-shadow-hide",$(e.dragShadowHide).html('<div class="home-drag-img BORDERRADIUS" id="home-drag-img"></div>')},start:{},end:{},setDropPosition:function(a,n,t){var s=n;if(a[n].length<=t)return a;return function e(){var i=0;return a[s+=1]?a[s].length>t?(i=a[s-1][t],a[s].unshift(i),a[n].splice(t,1),void e()):(i=a[s-1][t],a[s].unshift(i),a[n].splice(t,1),a):(i=a[s-1][t],a[s]=[],a[s].unshift(i),a[n].splice(t-1,1),a)}()},checkEndPageIsFull:function(){var e=this;if(e.start.page!=e.end.page){if(SETTING.row*SETTING.column<=$(".group:nth-child("+(e.end.page+1)+")").children(".icon-item-out").length)return infinity.alert({html:infinity.i18n("this_page_no_space")}),!0;infinity.alertHide()}else infinity.alertHide();return!1},ondrag:function ondrag(){var self=this;self.isDraging=!0,$(document).on("drag",".icon-item-out",function(e){$(this).before(self.dragShadow),$(self.dragShadow).show(),$(this).remove()}),$(document).on("dragstart",".icon-item-out",function(event){try{iEditDelete.end()}catch(e){}var $obj=$(this),obj=this,icons=infinity.get("infinity-icons"),iconsLength=icons.length,startPosition=$obj.index();self.start={page:_app.data.currentPage,position:startPosition},self.end={page:_app.data.currentPage,position:startPosition},$(".home-drag-hover").css("display","flex"),eval("console.log(obj)"),obj.ondragend=function(){self.isDraging=!1;var e=$(self.dragShadow).index();self.end.position=e,self.end.page=_app.data.currentPage;var i=SETTING.row*SETTING.column,a=infinity.get("infinity-icons"),n=a[self.end.page].length,t=a[self.start.page][self.start.position];if(self.start.page==self.end.page)a[self.start.page].splice(self.start.position,1),a[self.end.page].splice(self.end.position,0,t);else if(i<=n);else{a[self.end.page].splice(self.end.position,0,t),self.setDropPosition(a,self.end.page,i);var s=a[self.start.page].indexOf(t);a[self.start.page].splice(s,1)}a[self.start.page].length||a.splice(self.start.page,1),_app.data.groups=a,_app.render(),infinity.set("infinity-icons",a),$(".home-drag-hover").css("display","none"),infinity.sendMessage("icon-handle",{type:"drag",page:self.end.page}),infinity.sendMessage("backupToCloud"),infinity.alertHide()}}),$(".home-drag-hover").on("dragenter",function(e){$(this).addClass("home-drag-hover-show");var i=parseInt($(this).attr("data-direction"));self.dragSlideLock||(self.dragSlideLock=!0,i?iView.slideToLeft(function(){if(iView.setPoniter(),self.end.page=_app.data.currentPage,self.dragSlideLock=!1,iView.lock=!1,!self.checkEndPageIsFull()){var e=_app.data.currentPage+1,i=$(".group:nth-child("+e+")").find(".icon-item-out:last-child")[0];self.isDraging&&$(self.dragShadow).insertAfter(i)}}):iView.slideToRight(function(){if(iView.setPoniter(),self.end.page=_app.data.currentPage,self.dragSlideLock=!1,iView.lock=!1,!self.checkEndPageIsFull()){var e=_app.data.currentPage+1,i=$(".group:nth-child("+e+")").find(".icon-item-out:last-child")[0];self.isDraging&&$(self.dragShadow).insertAfter(i)}}))}),$(".home-drag-hover").on("dragleave",function(e){$(".home-drag-hover").removeClass("home-drag-hover-show")}),$(document).on("dragover",".item-icon",function(e){e.preventDefault();var i=this;(self.end.page=$(i).parents(".group").index(".group"),self.checkEndPageIsFull())||($(self.dragShadow).index()<$(i.parentNode).index()?$(self.dragShadow).insertAfter(i.parentNode):$(self.dragShadow).insertBefore(i.parentNode))})}};infinityDrag.init();